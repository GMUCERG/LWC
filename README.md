![Main Test](https://github.com/GMUCERG/LWC/workflows/Main%20Test/badge.svg?branch=dev)
# LWC HARDWARE API
This is a development package for the GMU authenticated encryption hardware API.
This package is divided into two primary parts: hardware and software.


## Hardware
`$root/hardware`

Templates for `CryptoCore` and `design_pkg`.

* `./LWCsrc`

    Universal Pre- and Post-processors and the associated testbench.
    
*  `./dummy_lwc`
   
    Example implementation of a dummy authenticated cipher and hash function. 

    The full source list required to implement and simulate the design can be found in the ModelSim script located in the /scripts folder.
    Note: It is recommended to use the provided ModelSim script for a quick evaluation of the design.

    * `./src_rtl`
   
        Code that is required for implementation.
        
    * `./KAT`
    
        Known-Answer-Test files folder.

        * `./KAT_{8,16,32}`
    
            Known-Answer-Test files for a 8, 16, and 32 bus width
           
        * `./KAT_MS_{8,16,32}`
    
            Known-Answer-Test files with multiple segments for
            plaintext, ciphertext, associated data and hash message


    * `./scripts`
    
        ModelSim script for a quick simulation.
        Vivado script for a quick simulation.

### LWC Lint, Simulation, and Synthesis Framework
The lint, simulation, and synthesis framework consists of a set of user-includable base makefiles (lwc_*.mk). 
Core developers should provide their design specific Makefile which incorporates the framework functionality 
through a series of “include” statements.

A core designers would a create a `Makefile` in their design directory. In this design-specific `Makefile`, they 
would set the variable `LWC_ROOT` to point to the top LWC package directory (e.g. relative path where LWC package is added as a 
[git submodule](https://git-scm.com/book/en/v2/Git-Tools-Submodules)) and "include" the desired `lwc.mk` file to 
gain access to the corresponding tools through the use of make rules. 

Please see the accompanying example `dummy_lwc` [Makefile](hardware/dummy_lwc/src_rtl/Makefile).

After setting up the `Makefile`, invoking any of the tools would be as easy as issuing:

`$ make <TARGETNAME>`

Where `<TARGETNAME>` is any of the following available rules:


- Lint targets:
    - `lint-vhdl`: invokes GHDL in checking mode. Requires installation of GHDL.
    - `lint-vhdl-synth`: invokes GHDL synthesis without generating any output files. Requires installation of GHDL.
    - `lint-verilog`: invokes Verilator in lint mode. Requires installation of Verilator
    - `lint-yosys`: which reads both Verilog and VHDL files in yosys and performs a quick check. Requires installation of yosys, GHDL, and ghdl-yosys-plugin.

- Simulation targets:
    - `sim-ghdl`: run simulation of VHDL design using GHDL. Input data and golden output files can be specified in `config.ini`.
    - `sim-vcs`: run simulation of VHDL/Verilog design using Synopsys VCS. Input data and golden output files can be specified in `config.ini`.

- Synthesis targets:
  - FPGA:
    - `synth-yosys-fpga`: Yosys FPGA synthesis targeting Lattice and Xilinx devices.
  - ASIC:
    - `synth-dc`: ASIC synthesis using Synopsys Design Compiler. PDK and standard-cell library can be configured. FreePDK-45/nangate library is included.

- Misc. targets:
  - `clean-<TOOL>` clean-up files generated by `<TOOL>`
  - `help-<TOOL>` help regarding specific target/tool.



The open-source tools can be either run through Docker or directly from the the installation of the tools on the user's machine.

#### Docker (recommended)
Running through Docker is easy and recommended as it ensures that the correct version of the tools are being used.
To run the EDA tools using docker:
  - Install [Docker](https://docs.docker.com/get-docker/). Make sure the docker daemon is running and `docker` is in your `PATH`.
  - `export USE_DOCKER=1` in the bash session, or add `USE_DOCKER=1` to every `make` command.

#### Local installation
If you decide to run locally installed versions of the Open-Source tools, you will require the following dependencies:
  - [GHDL](https://github.com/ghdl/ghdl) open-source VHDL simulator and synthesizer: Version 0.38 (upon release), master, or [nightly binaries](https://github.com/ghdl/ghdl/releases/tag/nightly)
  - [Verilator](https://github.com/verilator/verilator) fast open-source Verilog/SystemVerilog simulator: Version v4.036
  - [Yosys](https://github.com/YosysHQ/yosys) Open SYnthesis Suite: 0.9+ or master
  - [ghdl-yosys-plugin](https://github.com/ghdl/ghdl-yosys-plugin) for VHDL synthesis using ghdl and yosys: master
  - Python 3.6.5+
  - GNU Make 4.1+


List of external core examples adopted to the latest framework:
- [COMET-CHAM implementation by Virginia Tech](https://github.com/kammoh/comet_cham_lwc_v2/tree/dev): VHDL CryptoCore (`dev` branch)
- [SpoC implementation by Virginia Tech](https://github.com/kammoh/spoc_lwc/tree/dev): Verilog CryptoCore (`dev` branch)
- [Xoodoo by the Keccak Team](https://github.com/kammoh/Xoodoo/tree/lwc_pkg_v3): VHDL CryptoCore (`lwc_pkg_v3` branch)

### Notable Configurable LWC Options

#### `design_pkg.vhd` constants
Definition and initialization of these constants _MUST_ be present in the user-provided `design_pkg.vhd` file. See [dummy core's design_pkg](hardware/dummy_lwc/src_rtl/design_pkg.vhd) for an example.
- `ASYNC_RSTN` (boolean): When `True` an asynchronous active-low reset is used instead of a synchronous active-high reset.
- `CCW`, `CCSW`, `CCWdiv8` (integer): `CCW` specifies the bus width (in bits) of `CryptoCore`'s PDI data and can be 8, 16, or 32. 
  `CCSW` is the bus width (in bits) of `CryptoCore`'s SDI data and is expected to be equal to `CCW`.
  `CCWdiv8` needs to be set equal to `CCW / 8`.
- `TAG_SIZE` (integer): Controls the tag size in bits.
- `HASH_VALUE_SIZE` (integer): Controls the hash size in bits. Only used in hash mode.
 
#### `LWC_TB` and `LWC` top-level generics
- `G_W` (integer **default=32**): Controls the width of the external bus for PDI data bits.
  The width of SDI data (`SW`) is also set equal to this value.
  Valid values are 8, 16, 32.
  Supported combinations of (`G_W`, `CCW`) are (32, 32), (32, 16), (32, 8), (16, 16), or (8, 8).
  When using the simulation and synthesis framework, the value of this generic is dynamically updated from the value configured in the core's `config.ini`, 
  for both `LWC_TB` and `LWC` top modules, corresponding to simulation and synthesis targets. 
  Otherwise, users may need to manually change the defaults values in `LWC_TB.vhd` and `LWC.vhd`, making sure they both have the same value, or override them through their utilized simulation and synthesis tools.





## Software

* `$(LWC_ROOT)/software/dummy_lwc_ref/crypto_aead`
  Dummy AEAD reference implementation.
  Folder follows SUPERCOP package structure.
    
* `$(LWC_ROOT)/software/dummy_lwc_ref/crypto_hash`
  Dummy hash reference implementation.
  Folder follows SUPERCOP package structure. 
  
* `$(LWC_ROOT)/software/cryptotvgen`
  Python utility and library for the cryptographic hardware test vector generation tool.
  `cryptotvgen` can automatically download and build reference software implementations from [SUPERCOP](https://bench.cr.yp.to/supercop.html)'s website.
  Please see `cryptotvgen` [documentations](./software/cryptotvgen/README.md) for further details.


## Notes
Please refer to the latest Implementer’s Guide to the LWC Hardware API
available at https://cryptography.gmu.edu/athena/index.php?id=LWC
for more detail.
